<% first_item = (current_user.cart.nil? ? true : (current_user.cart.num_item_service_requests == 1)) %>

// reconfigure menu items on mouse-over menu for this item
var donation_link_element = document.getElementById('stored_item_<%= @stored_item.id %>_donation_link');
donation_link_element.innerHTML = 'cancel donation';
donation_link_element.href = '/stored_items/<%=@stored_item.id%>/cancel_donation_request';

var container = document.getElementById("stored_item_<%=@stored_item.id%>_menu_list");

// remove other options -- those are no longer available if you've chosen to donate
var mail_element = document.getElementById("stored_item_<%=@stored_item.id%>_mail_li")
container.removeChild(mail_element)
var sell_element = document.getElementById("stored_item_<%=@stored_item.id%>_sell_li")
container.removeChild(sell_element)
var dispose_element = document.getElementById("stored_item_<%=@stored_item.id%>_dispose_li")
container.removeChild(dispose_element)

var new_element = document.createElement('li');
new_element.innerHTML = '<a href="/account/check_out">checkout</a>';
new_element.id = 'stored_item_<%=@stored_item.id%>_checkout_li';
container.insertBefore(new_element, container.lastChild);

var new_div = document.createElement('div');
new_div.className = 'browse-item-service';
new_div.id = 'item-<%=@stored_item.id%>-service-div'
new_div.innerHTML = 'Donation<br>Requested'
new_div.style.display = 'none'
wider_container = document.getElementById("stored_item_<%=@stored_item.id%>_menu");
wider_container.insertBefore(new_div, wider_container.lastChild)

// refresh the cart image at the top of the screen
<% if !current_user.cart.nil? && !current_user.cart.empty? %>
	var cart_display = document.getElementById("cart-display");
	cart_display.innerHTML = '<p><a href="/account/cart">service requests in cart: <%= current_user.cart.num_items %></a></p>';
	cart_display.style.display = 'block';
<% end %>

<% if first_item %> 
	$("#first_item_processing_link").trigger('click');
<% end %>

