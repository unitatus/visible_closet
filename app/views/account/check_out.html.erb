<% @menu_page = :account %>
<%= render 'account/account_nav', :locals => { :menu_page => @menu_page } %>
<script language=javascript>
function openMemberAgreement() {
                window.radopen("membership_agrement", "Agreement");
            }
</script>
<div id="internal-right">
	<h1>Confirm Order</h1>
	<% if @order.errors.size > 0 %>
	<% # If there is a credit card error, it is always followed by garbage. %>
		<% if not @order.errors[:cc_response].nil? %>
	  <div class="error_label"><%= @order.errors[:cc_response][0] %></div><br>
		<% end %>
	<% end %>
	
<%= form_for @order, :url => "/account/finalize_check_out", :html => { :class => "standard" } do |f| %>
<div id="upper">
<div style="width: 200px; float: left;">
	<div class="simple_header">Shipping Address</div><br>
	<%= hidden_field_tag :shipping_address_id, @shipping_address.id %>
	<%= @shipping_address.first_name %> <%= @shipping_address.last_name %>
	<br><%= @shipping_address.address_line_1 %>
	<% if !@shipping_address.address_line_2.blank? %>
	<br><%= @shipping_address.address_line_2 %>
	<% end %>
	<br><%= @shipping_address.city %>, <%= @shipping_address.state %>
	<br><%= @shipping_address.zip %>
	<br>Day Phone: <%= number_to_phone(@shipping_address.day_phone) %>
	<% if !@shipping_address.evening_phone.nil? %>
	<br>Evening Phone: <%= number_to_phone(@shipping_address.evening_phone) %>
	<% end %>
	<br><br>
	<% if @addresses.size > 1 %>
	<a href="/account/select_new_shipping_address">Choose other address</a><br>
	<% end %>
	<a href="/account/add_new_shipping_address">Enter new address</a>
</div>
<div style="width: 300px; float: right; margin-right: 100px">
	<br>
<div class="simple_header" style="padding: 0 0 0 0">Credit Card (default on file)</div><br>
<% profile = current_user.default_payment_profile %>
<b><%= profile.cc_type.capitalize %></b> ending in <%= profile.last_four_digits %>.<br>
Name on card: <%= profile.first_name %> <%= profile.last_name %><br>
Expires on: <%= profile.month %>/<%= profile.year %><br><br>
	<a href="/payment_profiles">Manage your cards</a> | <a href="/payment_profiles/new?source_c=account&source_a=check_out">Enter new default card</a>
</div>
<div style="clear: both">
</div>
</div>
<br><br>
<hr>
	<table class="check_out_cart_summary">
		<tr>
			<th>
				Item
			</th>
			<th>
				Quantity
			</th>
			<th>
				Price
			</th>
			<th>
				Due Now
			</th>
		</tr><% @cart.cart_items.each do |cart_item| %>
			<% product = Product.find(cart_item.product_id) %>
		<tr>
			<td align="left">
				<%= product.name %>
			</td>
			<td>
				<%= cart_item.quantity %>
			</td>
			<td>
				<%= number_to_currency(product.price) %> <%= product.price_comment %>
			</td>
			<td align="right">
				<%= number_to_currency(product.due_at_signup * cart_item.quantity) %>
				<% if product.id == Rails.application.config.our_box_product_id %>
					<a href="#vc_box_inline" id="vc_product_link" title="Visible Closet Box Details">(why?)</a>
				<% elsif product.id == Rails.application.config.your_box_product_id %>
					<a href="#cust_box_inline" id="cust_product_link" title="Customer Box Details">(why?)</a>
				<% end %>
			</td>
		</tr><% end %> <!-- end loop -->
	</table>
	<br>
	<hr>
	<div style="text-align:right; position:relative; padding: 0 20px 10px 0;">
	<b>Total: <%= number_to_currency(@cart.estimated_total) %></b>
	</div><br>
	<div class="small-print">By clicking 'Store My Boxes!' below, I certify that I have read and agree to the <a id="member_agreement_link" href="/member_agreement_ajax">Member Agreement</a> associated with this service. I understand that I will be responsible for paying all shipping and storage charges billed to my account by thevisiblecloset.com</div>
	<div style="text-align: right; padding: 20px 0 0 0">
	<%= submit_tag("Store My Boxes!", :class => "button") %>
	</div>
	<br>
</div>
<% end %> <!-- end form -->
<div class="clearer"></div>
<div style="display: none">
<div id="cust_box_inline" style="text-align: center"><b>Why am I ordering my own box?</b><br><br>We want to make sure that when we receive your box we know who sent it! <br>By clicking "submit" you will create a record of your box in your account, and receive instructions on how to ship it. <br>You can also track your box while it's in transit, and name the box for your own reference. </div>
<div id="vc_box_inline" style="text-align: center"><b>Why am I paying for this box?</b><br><br>Ordering a box from The Visible Closet requires that you pay your first month's rent up front. <br>Once you complete your order we will send you your free shipping materials. <br>You do not pay any more storage costs until your box has been in storage for one month.</div>
</div>